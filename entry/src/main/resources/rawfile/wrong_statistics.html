<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>é”™é¢˜ç»Ÿè®¡åˆ†æ</title>
  <script src="echarts.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    html, body {
      width: 100%;
      height: 100%;
      background: #F5F7FA;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    
    .chart-container { width: 100%; padding: 12px; }
    
    .chart-card {
      background: #FFFFFF;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: #333333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title .icon { font-size: 18px; }
    
    /* æ¦‚è§ˆç»Ÿè®¡å¡ç‰‡ */
    .overview-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .overview-item {
      background: linear-gradient(135deg, #f8faff 0%, #f0f5ff 100%);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 1px solid rgba(24, 144, 255, 0.1);
    }
    
    .overview-item.error {
      background: linear-gradient(135deg, #fff8f8 0%, #fff0f0 100%);
      border-color: rgba(255, 77, 79, 0.1);
    }
    
    .overview-item.success {
      background: linear-gradient(135deg, #f8fff8 0%, #f0fff0 100%);
      border-color: rgba(82, 196, 26, 0.1);
    }
    
    .overview-item.warning {
      background: linear-gradient(135deg, #fffcf0 0%, #fff8e6 100%);
      border-color: rgba(250, 173, 20, 0.1);
    }
    
    .overview-value {
      font-size: 28px;
      font-weight: 700;
      color: #1890FF;
      line-height: 1.2;
    }
    
    .overview-item.error .overview-value { color: #FF4D4F; }
    .overview-item.success .overview-value { color: #52C41A; }
    .overview-item.warning .overview-value { color: #FAAD14; }
    
    .overview-label { font-size: 13px; color: #666666; margin-top: 4px; }
    
    /* å›¾è¡¨å®¹å™¨ */
    .chart-box { width: 100%; height: 260px; }
    .chart-box.large { height: 300px; }
    
    /* é¢˜å‹åˆ†å¸ƒå°å¡ç‰‡ */
    .type-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 12px;
    }
    
    .type-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 10px 6px;
      text-align: center;
    }
    
    .type-name { font-size: 11px; color: #666; margin-bottom: 4px; }
    .type-count { font-size: 16px; font-weight: 600; color: #333; }
    .type-rate { font-size: 10px; color: #FF4D4F; margin-top: 2px; }
    
    /* ç§‘ç›®åˆ—è¡¨ */
    .subject-list { margin-top: 8px; }
    
    .subject-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .subject-item:last-child { border-bottom: none; }
    
    .subject-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 10px;
      flex-shrink: 0;
    }
    
    .subject-info { flex: 1; min-width: 0; }
    .subject-name { font-size: 14px; color: #333; font-weight: 500; }
    
    .subject-bar {
      height: 6px;
      background: #f0f0f0;
      border-radius: 3px;
      margin-top: 6px;
      overflow: hidden;
    }
    
    .subject-bar-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.6s ease;
    }
    
    .subject-stats { text-align: right; margin-left: 12px; }
    .subject-count { font-size: 16px; font-weight: 600; color: #FF4D4F; }
    .subject-rate { font-size: 12px; color: #999; margin-top: 2px; }

    /* æ™ºèƒ½åˆ†æå»ºè®® */
    .analysis-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 12px;
      color: #fff;
    }
    
    .analysis-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .analysis-item {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 10px;
    }
    
    .analysis-item:last-child { margin-bottom: 0; }
    
    .analysis-item-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .analysis-item-content {
      font-size: 13px;
      line-height: 1.6;
      opacity: 0.95;
    }
    
    .analysis-tag {
      display: inline-block;
      background: rgba(255, 255, 255, 0.25);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      margin-right: 6px;
    }
    
    .analysis-highlight {
      color: #FFD700;
      font-weight: 600;
    }
    
    /* é«˜é¢‘é”™é¢˜åˆ—è¡¨ */
    .high-freq-list { margin-top: 8px; }
    
    .high-freq-item {
      display: flex;
      align-items: flex-start;
      padding: 14px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .high-freq-item:last-child { border-bottom: none; }
    
    .high-freq-rank {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: #fff;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    .high-freq-rank.top1 { background: linear-gradient(135deg, #FF6B6B, #FF4757); }
    .high-freq-rank.top2 { background: linear-gradient(135deg, #FFA502, #FF7F50); }
    .high-freq-rank.top3 { background: linear-gradient(135deg, #FFD93D, #F9CA24); color: #333; }
    .high-freq-rank.normal { background: #E8E8E8; color: #666; }
    
    .high-freq-content { flex: 1; min-width: 0; }
    
    .high-freq-question {
      font-size: 14px;
      color: #333;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .high-freq-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }
    
    .high-freq-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      color: #fff;
    }
    
    .high-freq-count {
      font-size: 12px;
      color: #FF4D4F;
      font-weight: 500;
    }
    
    .high-freq-type {
      font-size: 11px;
      color: #999;
    }
    
    /* ç©ºçŠ¶æ€ */
    .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    .empty-state .icon { font-size: 56px; margin-bottom: 16px; }
    .empty-state .text { font-size: 15px; line-height: 1.6; }
    
    /* åŠ è½½çŠ¶æ€ */
    .loading { display: flex; justify-content: center; align-items: center; height: 200px; }
    
    .loading-spinner {
      width: 36px;
      height: 36px;
      border: 3px solid #f0f0f0;
      border-top-color: #1890FF;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="chart-container" id="chartContainer">
    <div class="loading" id="loadingState">
      <div class="loading-spinner"></div>
    </div>
  </div>

  <script>
    // å…¨å±€å›¾è¡¨å®ä¾‹
    var subjectPieChart = null;
    var typePieChart = null;
    var trendLineChart = null;
    var weekBarChart = null;
    
    // ç§‘ç›®é¢œè‰²æ˜ å°„
    var SUBJECT_COLORS = {
      '001': '#1677FF', '002': '#389E0D', '003': '#D46B08',
      '004': '#C41D7F', '005': '#531DAB', '006': '#006D75', '007': '#AD2102'
    };
    
    // ç§‘ç›®åç§°æ˜ å°„
    var SUBJECT_NAMES = {
      '001': 'åŸºç¡€çŸ¥è¯†', '002': 'æ··å‡åœŸå·¥ç¨‹', '003': 'å²©åœŸ(å²©çŸ³)',
      '004': 'å²©åœŸ(åœ°åŸº)', '005': 'é‡æµ‹', '006': 'é‡‘å±ç»“æ„', '007': 'æœºæ¢°ç”µæ°”'
    };
    
    // é¢˜å‹åç§°æ˜ å°„
    var TYPE_NAMES = { 'single': 'å•é€‰é¢˜', 'multiple': 'å¤šé€‰é¢˜', 'judge': 'åˆ¤æ–­é¢˜', 'case': 'æ¡ˆä¾‹é¢˜' };
    
    /** åˆå§‹åŒ–å›¾è¡¨ - ç”± ArkTS è°ƒç”¨ */
    function initCharts(dataJson) {
      try {
        var data = JSON.parse(dataJson);
        document.getElementById('loadingState').style.display = 'none';
        
        if (!data || data.totalWrong === 0) {
          showEmptyState();
          return;
        }
        renderCharts(data);
      } catch (e) {
        console.error('initCharts error:', e);
        showEmptyState();
      }
    }
    
    /** æ˜¾ç¤ºç©ºçŠ¶æ€ */
    function showEmptyState() {
      document.getElementById('chartContainer').innerHTML = 
        '<div class="empty-state">' +
        '<div class="icon">ğŸ“Š</div>' +
        '<div class="text">æš‚æ— é”™é¢˜æ•°æ®<br>åšé”™çš„é¢˜ç›®ä¼šåœ¨è¿™é‡Œç»Ÿè®¡åˆ†æ</div>' +
        '</div>';
    }
    
    /** æ¸²æŸ“æ‰€æœ‰å›¾è¡¨ */
    function renderCharts(data) {
      var container = document.getElementById('chartContainer');
      
      container.innerHTML = 
        '<div class="chart-card">' +
          '<div class="card-title"><span class="icon">ğŸ“ˆ</span>é”™é¢˜æ¦‚è§ˆ</div>' +
          '<div class="overview-grid">' +
            '<div class="overview-item error"><div class="overview-value">' + data.totalWrong + '</div><div class="overview-label">é”™é¢˜æ€»æ•°</div></div>' +
            '<div class="overview-item warning"><div class="overview-value">' + data.todayWrong + '</div><div class="overview-label">ä»Šæ—¥æ–°å¢</div></div>' +
            '<div class="overview-item success"><div class="overview-value">' + data.masteredCount + '</div><div class="overview-label">å·²æŒæ¡</div></div>' +
            '<div class="overview-item"><div class="overview-value">' + data.avgWrongRate + '%</div><div class="overview-label">å¹³å‡é”™è¯¯ç‡</div></div>' +
          '</div>' +
        '</div>' +
        '<div class="chart-card">' +
          '<div class="card-title"><span class="icon">ğŸ¯</span>ç§‘ç›®é”™é¢˜åˆ†å¸ƒ</div>' +
          '<div class="chart-box" id="subjectPieChart"></div>' +
          '<div class="subject-list" id="subjectList"></div>' +
        '</div>' +
        '<div class="chart-card">' +
          '<div class="card-title"><span class="icon">ğŸ“</span>é¢˜å‹é”™è¯¯åˆ†æ</div>' +
          '<div class="chart-box" id="typePieChart"></div>' +
          '<div class="type-grid" id="typeGrid"></div>' +
        '</div>' +
        '<div class="chart-card">' +
          '<div class="card-title"><span class="icon">ğŸ“‰</span>è¿‘7å¤©é”™é¢˜è¶‹åŠ¿</div>' +
          '<div class="chart-box large" id="trendLineChart"></div>' +
        '</div>' +
        '<div class="chart-card">' +
          '<div class="card-title"><span class="icon">ğŸ“Š</span>æœ¬å‘¨ç­”é¢˜ç»Ÿè®¡</div>' +
          '<div class="chart-box large" id="weekBarChart"></div>' +
        '</div>' +
        '<div class="chart-card">' +
          '<div class="card-title"><span class="icon">ğŸ”¥</span>é«˜é¢‘é”™é¢˜ TOP 10</div>' +
          '<div class="high-freq-list" id="highFreqList"></div>' +
        '</div>' +
        '<div id="analysisCard"></div>';
      
      setTimeout(function() {
        initSubjectPieChart(data.subjectDistribution);
        initTypePieChart(data.typeDistribution);
        initTrendLineChart(data.weekTrend);
        initWeekBarChart(data.weekStats);
        renderSubjectList(data.subjectDistribution);
        renderTypeGrid(data.typeDistribution);
        renderHighFreqList(data.highFreqWrong);
        renderAnalysis(data);
      }, 100);
    }
    
    /** ç”Ÿæˆæ™ºèƒ½åˆ†æå»ºè®® */
    function renderAnalysis(data) {
      var analysisItems = [];
      
      // 1. åˆ†æè–„å¼±ç§‘ç›®
      var weakSubjects = data.subjectDistribution
        .filter(function(s) { return s.count > 0; })
        .sort(function(a, b) { return b.count - a.count; });
      
      if (weakSubjects.length > 0) {
        var topSubject = weakSubjects[0];
        var topName = SUBJECT_NAMES[topSubject.subjectId] || topSubject.subjectId;
        var total = weakSubjects.reduce(function(sum, s) { return sum + s.count; }, 0);
        var topPercent = Math.round(topSubject.count / total * 100);
        
        var subjectAdvice = '';
        if (topPercent >= 50) {
          subjectAdvice = 'ã€Œ<span class="analysis-highlight">' + topName + '</span>ã€å é”™é¢˜çš„ ' + topPercent + '%ï¼Œæ˜¯ä½ çš„ä¸»è¦è–„å¼±ç‚¹ã€‚å»ºè®®é›†ä¸­ç²¾åŠ›æ”»å…‹è¿™ä¸ªç§‘ç›®ï¼Œå¯ä»¥å…ˆå¤ä¹ ç›¸å…³çŸ¥è¯†ç‚¹å†åˆ·é¢˜ã€‚';
        } else if (weakSubjects.length >= 3) {
          subjectAdvice = 'é”™é¢˜åˆ†å¸ƒåœ¨å¤šä¸ªç§‘ç›®ï¼Œå…¶ä¸­ã€Œ<span class="analysis-highlight">' + topName + '</span>ã€é”™é¢˜æœ€å¤šï¼ˆ' + topSubject.count + 'é¢˜ï¼‰ã€‚å»ºè®®åˆ¶å®šå„ç§‘ç›®çš„å¤ä¹ è®¡åˆ’ï¼Œé€ä¸ªå‡»ç ´ã€‚';
        } else {
          subjectAdvice = 'ã€Œ<span class="analysis-highlight">' + topName + '</span>ã€æœ‰ ' + topSubject.count + ' é“é”™é¢˜éœ€è¦å¤ä¹ ã€‚ä¿æŒå½“å‰å­¦ä¹ èŠ‚å¥ï¼Œç»§ç»­åŠ æ²¹ï¼';
        }
        
        analysisItems.push({
          icon: 'ğŸ“š',
          title: 'è–„å¼±ç§‘ç›®',
          content: subjectAdvice
        });
      }
      
      // 2. åˆ†æé¢˜å‹é—®é¢˜
      var weakTypes = data.typeDistribution
        .filter(function(t) { return t.wrongCount > 0; })
        .sort(function(a, b) { return b.wrongRate - a.wrongRate; });
      
      if (weakTypes.length > 0) {
        var worstType = weakTypes[0];
        var typeName = TYPE_NAMES[worstType.type] || worstType.type;
        
        var typeAdvice = '';
        if (worstType.wrongRate >= 50) {
          typeAdvice = 'ã€Œ<span class="analysis-highlight">' + typeName + '</span>ã€é”™è¯¯ç‡é«˜è¾¾ ' + worstType.wrongRate + '%ï¼';
          if (worstType.type === 'multiple') {
            typeAdvice += 'å¤šé€‰é¢˜å®¹æ˜“æ¼é€‰æˆ–å¤šé€‰ï¼Œå»ºè®®ä»”ç»†å®¡é¢˜ï¼Œæ³¨æ„"å…¨é€‰"å’Œ"éƒ¨åˆ†é€‰"çš„åŒºåˆ«ã€‚';
          } else if (worstType.type === 'judge') {
            typeAdvice += 'åˆ¤æ–­é¢˜è¦æ³¨æ„ç»å¯¹åŒ–è¡¨è¿°ï¼ˆå¦‚"ä¸€å®š"ã€"å¿…é¡»"ï¼‰ï¼Œè¿™ç±»å¾€å¾€æ˜¯é”™è¯¯é€‰é¡¹ã€‚';
          } else {
            typeAdvice += 'å»ºè®®å¤šåšåŒç±»å‹é¢˜ç›®ï¼Œæ€»ç»“è§£é¢˜è§„å¾‹ã€‚';
          }
        } else if (worstType.wrongRate >= 30) {
          typeAdvice = 'ã€Œ<span class="analysis-highlight">' + typeName + '</span>ã€é”™è¯¯ç‡ ' + worstType.wrongRate + '%ï¼Œè¿˜æœ‰æå‡ç©ºé—´ã€‚å¤šç»ƒä¹ å¯ä»¥æé«˜æ­£ç¡®ç‡ã€‚';
        } else {
          typeAdvice = 'å„é¢˜å‹è¡¨ç°å‡è¡¡ï¼Œã€Œ' + typeName + 'ã€é”™è¯¯ç‡æœ€é«˜ä½†ä»… ' + worstType.wrongRate + '%ï¼Œç»§ç»­ä¿æŒï¼';
        }
        
        analysisItems.push({
          icon: 'âœï¸',
          title: 'é¢˜å‹åˆ†æ',
          content: typeAdvice
        });
      }
      
      // 3. åˆ†æå­¦ä¹ è¶‹åŠ¿
      if (data.weekTrend && data.weekTrend.length >= 3) {
        var recentTrend = data.weekTrend.slice(-3);
        var totalRecent = recentTrend.reduce(function(sum, d) { return sum + d.totalCount; }, 0);
        var wrongRecent = recentTrend.reduce(function(sum, d) { return sum + d.wrongCount; }, 0);
        
        var trendAdvice = '';
        if (totalRecent === 0) {
          trendAdvice = 'æœ€è¿‘3å¤©æ²¡æœ‰åšé¢˜è®°å½•ï¼Œ<span class="analysis-highlight">åšæŒæ¯å¤©åˆ·é¢˜</span>æ‰èƒ½ä¿æŒæ‰‹æ„Ÿå“¦ï¼å»ºè®®æ¯å¤©è‡³å°‘åš10é“é¢˜ã€‚';
        } else {
          var recentRate = Math.round(wrongRecent / totalRecent * 100);
          if (recentRate <= 20) {
            trendAdvice = 'è¿‘3å¤©æ­£ç¡®ç‡é«˜è¾¾ <span class="analysis-highlight">' + (100 - recentRate) + '%</span>ï¼ŒçŠ¶æ€å¾ˆæ£’ï¼å¯ä»¥å°è¯•æŒ‘æˆ˜æ›´éš¾çš„é¢˜ç›®ã€‚';
          } else if (recentRate <= 40) {
            trendAdvice = 'è¿‘3å¤©é”™è¯¯ç‡ ' + recentRate + '%ï¼Œè¡¨ç°ç¨³å®šã€‚å»ºè®®é‡ç‚¹å¤ä¹ é”™é¢˜ï¼Œå·©å›ºè–„å¼±çŸ¥è¯†ç‚¹ã€‚';
          } else {
            trendAdvice = 'è¿‘3å¤©é”™è¯¯ç‡è¾ƒé«˜ï¼ˆ' + recentRate + '%ï¼‰ï¼Œåˆ«ç°å¿ƒï¼å»ºè®®<span class="analysis-highlight">æ”¾æ…¢åšé¢˜é€Ÿåº¦</span>ï¼Œè®¤çœŸå®¡é¢˜ï¼Œè´¨é‡æ¯”æ•°é‡æ›´é‡è¦ã€‚';
          }
        }
        
        analysisItems.push({
          icon: 'ğŸ“ˆ',
          title: 'å­¦ä¹ å»ºè®®',
          content: trendAdvice
        });
      }
      
      // 4. æŒæ¡æƒ…å†µåˆ†æ
      if (data.masteredCount > 0 || data.totalWrong > 0) {
        var masteredAdvice = '';
        var masteredRate = data.totalWrong > 0 ? Math.round(data.masteredCount / (data.masteredCount + data.totalWrong) * 100) : 0;
        
        if (masteredRate >= 70) {
          masteredAdvice = 'å·²æŒæ¡ <span class="analysis-highlight">' + data.masteredCount + '</span> é“é”™é¢˜ï¼ŒæŒæ¡ç‡ ' + masteredRate + '%ï¼Œéå¸¸ä¼˜ç§€ï¼ç»§ç»­æ”»å…‹å‰©ä½™çš„ ' + data.totalWrong + ' é“é”™é¢˜ã€‚';
        } else if (masteredRate >= 40) {
          masteredAdvice = 'å·²æŒæ¡ ' + data.masteredCount + ' é“é”™é¢˜ï¼Œè¿˜æœ‰ <span class="analysis-highlight">' + data.totalWrong + '</span> é“å¾…æ”»å…‹ã€‚å»ºè®®æ¯å¤©å¤ä¹ 5-10é“é”™é¢˜ï¼Œé€æ­¥æ¶ˆç­å®ƒä»¬ã€‚';
        } else {
          masteredAdvice = 'å½“å‰æœ‰ <span class="analysis-highlight">' + data.totalWrong + '</span> é“é”™é¢˜å¾…å¤ä¹ ã€‚é”™é¢˜æ˜¯æœ€å¥½çš„å­¦ä¹ èµ„æºï¼Œå»ºè®®ä¼˜å…ˆå¤ä¹ é”™è¯¯æ¬¡æ•°å¤šçš„é¢˜ç›®ã€‚';
        }
        
        analysisItems.push({
          icon: 'ğŸ¯',
          title: 'æ”»å…‹è¿›åº¦',
          content: masteredAdvice
        });
      }
      
      // æ¸²æŸ“åˆ†æå¡ç‰‡
      if (analysisItems.length > 0) {
        var html = '<div class="analysis-card">' +
          '<div class="analysis-title"><span>ğŸ’¡</span>æ™ºèƒ½åˆ†æå»ºè®®</div>';
        
        analysisItems.forEach(function(item) {
          html += '<div class="analysis-item">' +
            '<div class="analysis-item-title"><span>' + item.icon + '</span>' + item.title + '</div>' +
            '<div class="analysis-item-content">' + item.content + '</div>' +
            '</div>';
        });
        
        html += '</div>';
        document.getElementById('analysisCard').innerHTML = html;
      }
    }

    /** ç§‘ç›®åˆ†å¸ƒé¥¼å›¾ */
    function initSubjectPieChart(distribution) {
      var dom = document.getElementById('subjectPieChart');
      if (!dom) return;
      
      subjectPieChart = echarts.init(dom);
      
      var pieData = distribution.map(function(item) {
        return {
          value: item.count,
          name: SUBJECT_NAMES[item.subjectId] || item.subjectId,
          itemStyle: { color: SUBJECT_COLORS[item.subjectId] || '#999' }
        };
      }).filter(function(item) { return item.value > 0; });
      
      subjectPieChart.setOption({
        tooltip: {
          trigger: 'item',
          formatter: '{b}: {c}é¢˜ ({d}%)',
          backgroundColor: 'rgba(255,255,255,0.95)',
          borderColor: '#eee',
          borderWidth: 1,
          textStyle: { color: '#333', fontSize: 13 },
          padding: [8, 12]
        },
        series: [{
          type: 'pie',
          radius: ['45%', '70%'],
          center: ['50%', '50%'],
          avoidLabelOverlap: true,
          itemStyle: { borderRadius: 6, borderColor: '#fff', borderWidth: 2 },
          label: { show: true, position: 'outside', formatter: '{b}\n{d}%', fontSize: 11, color: '#666', lineHeight: 16 },
          labelLine: { show: true, length: 8, length2: 12, smooth: true },
          emphasis: {
            label: { show: true, fontSize: 13, fontWeight: 'bold' },
            itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.2)' }
          },
          data: pieData
        }]
      });
    }
    
    /** é¢˜å‹åˆ†å¸ƒé¥¼å›¾ */
    function initTypePieChart(distribution) {
      var dom = document.getElementById('typePieChart');
      if (!dom) return;
      
      typePieChart = echarts.init(dom);
      
      var typeColors = ['#1890FF', '#52C41A', '#FAAD14', '#722ED1'];
      var pieData = distribution.map(function(item, index) {
        return {
          value: item.wrongCount,
          name: TYPE_NAMES[item.type] || item.type,
          itemStyle: { color: typeColors[index % typeColors.length] }
        };
      }).filter(function(item) { return item.value > 0; });
      
      typePieChart.setOption({
        tooltip: {
          trigger: 'item',
          formatter: function(params) {
            var item = distribution.find(function(d) { return TYPE_NAMES[d.type] === params.name; });
            if (item) return params.name + '<br/>é”™é¢˜: ' + item.wrongCount + 'é¢˜<br/>é”™è¯¯ç‡: ' + item.wrongRate + '%';
            return params.name + ': ' + params.value + 'é¢˜';
          },
          backgroundColor: 'rgba(255,255,255,0.95)',
          borderColor: '#eee',
          borderWidth: 1,
          textStyle: { color: '#333', fontSize: 13 },
          padding: [8, 12]
        },
        series: [{
          type: 'pie',
          radius: ['40%', '65%'],
          center: ['50%', '50%'],
          roseType: 'radius',
          itemStyle: { borderRadius: 5, borderColor: '#fff', borderWidth: 2 },
          label: { show: true, formatter: '{b}\n{c}é¢˜', fontSize: 11, color: '#666' },
          labelLine: { length: 6, length2: 10 },
          emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.2)' } },
          data: pieData
        }]
      });
    }
    
    /** é”™é¢˜è¶‹åŠ¿æŠ˜çº¿å›¾ */
    function initTrendLineChart(weekTrend) {
      var dom = document.getElementById('trendLineChart');
      if (!dom) return;
      
      trendLineChart = echarts.init(dom);
      
      var dates = weekTrend.map(function(item) { return item.date.substring(5); });
      var wrongCounts = weekTrend.map(function(item) { return item.wrongCount; });
      var totalCounts = weekTrend.map(function(item) { return item.totalCount; });
      
      trendLineChart.setOption({
        tooltip: {
          trigger: 'axis',
          backgroundColor: 'rgba(255,255,255,0.95)',
          borderColor: '#eee',
          borderWidth: 1,
          textStyle: { color: '#333', fontSize: 12 },
          padding: [10, 14]
        },
        legend: { data: ['åšé¢˜æ•°', 'é”™é¢˜æ•°'], bottom: 0, itemWidth: 16, itemHeight: 8, textStyle: { fontSize: 12, color: '#666' } },
        grid: { left: 10, right: 10, top: 20, bottom: 40, containLabel: true },
        xAxis: { type: 'category', data: dates, axisLine: { lineStyle: { color: '#e8e8e8' } }, axisTick: { show: false }, axisLabel: { color: '#999', fontSize: 11 } },
        yAxis: { type: 'value', minInterval: 1, axisLine: { show: false }, axisTick: { show: false }, axisLabel: { color: '#999', fontSize: 11 }, splitLine: { lineStyle: { color: '#f0f0f0', type: 'dashed' } } },
        series: [
          {
            name: 'åšé¢˜æ•°', type: 'line', data: totalCounts, smooth: true, symbol: 'circle', symbolSize: 6,
            lineStyle: { width: 2, color: '#1890FF' }, itemStyle: { color: '#1890FF' },
            areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(24, 144, 255, 0.25)' }, { offset: 1, color: 'rgba(24, 144, 255, 0.02)' }] } }
          },
          {
            name: 'é”™é¢˜æ•°', type: 'line', data: wrongCounts, smooth: true, symbol: 'circle', symbolSize: 6,
            lineStyle: { width: 2, color: '#FF4D4F' }, itemStyle: { color: '#FF4D4F' },
            areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(255, 77, 79, 0.2)' }, { offset: 1, color: 'rgba(255, 77, 79, 0.02)' }] } }
          }
        ]
      });
    }

    /** æœ¬å‘¨ç­”é¢˜ç»Ÿè®¡æŸ±çŠ¶å›¾ */
    function initWeekBarChart(weekStats) {
      var dom = document.getElementById('weekBarChart');
      if (!dom) return;
      
      weekBarChart = echarts.init(dom);
      
      var days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
      var correctData = weekStats.map(function(item) { return item.correctCount; });
      var wrongData = weekStats.map(function(item) { return item.wrongCount; });
      
      weekBarChart.setOption({
        tooltip: {
          trigger: 'axis',
          axisPointer: { type: 'shadow' },
          backgroundColor: 'rgba(255,255,255,0.95)',
          borderColor: '#eee',
          borderWidth: 1,
          textStyle: { color: '#333', fontSize: 12 },
          padding: [10, 14],
          formatter: function(params) {
            var total = params[0].value + params[1].value;
            var rate = total > 0 ? Math.round(params[0].value / total * 100) : 0;
            return params[0].axisValue + '<br/><span style="color:#52C41A">â— æ­£ç¡®: ' + params[0].value + 'é¢˜</span><br/><span style="color:#FF4D4F">â— é”™è¯¯: ' + params[1].value + 'é¢˜</span><br/>æ­£ç¡®ç‡: ' + rate + '%';
          }
        },
        legend: { data: ['æ­£ç¡®', 'é”™è¯¯'], bottom: 0, itemWidth: 16, itemHeight: 8, textStyle: { fontSize: 12, color: '#666' } },
        grid: { left: 10, right: 10, top: 20, bottom: 40, containLabel: true },
        xAxis: { type: 'category', data: days, axisLine: { lineStyle: { color: '#e8e8e8' } }, axisTick: { show: false }, axisLabel: { color: '#666', fontSize: 12 } },
        yAxis: { type: 'value', minInterval: 1, axisLine: { show: false }, axisTick: { show: false }, axisLabel: { color: '#999', fontSize: 11 }, splitLine: { lineStyle: { color: '#f0f0f0', type: 'dashed' } } },
        series: [
          {
            name: 'æ­£ç¡®', type: 'bar', stack: 'total', barWidth: 20,
            itemStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: '#73D13D' }, { offset: 1, color: '#52C41A' }] }, borderRadius: [0, 0, 0, 0] },
            data: correctData
          },
          {
            name: 'é”™è¯¯', type: 'bar', stack: 'total', barWidth: 20,
            itemStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: '#FF7875' }, { offset: 1, color: '#FF4D4F' }] }, borderRadius: [4, 4, 0, 0] },
            data: wrongData
          }
        ]
      });
    }
    
    /** æ¸²æŸ“ç§‘ç›®åˆ—è¡¨ */
    function renderSubjectList(distribution) {
      var listDom = document.getElementById('subjectList');
      if (!listDom) return;
      
      var total = distribution.reduce(function(sum, item) { return sum + item.count; }, 0);
      
      var html = distribution
        .filter(function(item) { return item.count > 0; })
        .sort(function(a, b) { return b.count - a.count; })
        .map(function(item) {
          var percent = total > 0 ? Math.round(item.count / total * 100) : 0;
          var color = SUBJECT_COLORS[item.subjectId] || '#999';
          var name = SUBJECT_NAMES[item.subjectId] || item.subjectId;
          
          return '<div class="subject-item">' +
            '<div class="subject-dot" style="background: ' + color + '"></div>' +
            '<div class="subject-info"><div class="subject-name">' + name + '</div>' +
            '<div class="subject-bar"><div class="subject-bar-fill" style="width: ' + percent + '%; background: ' + color + '"></div></div></div>' +
            '<div class="subject-stats"><div class="subject-count">' + item.count + 'é¢˜</div><div class="subject-rate">' + percent + '%</div></div></div>';
        }).join('');
      
      listDom.innerHTML = html;
    }
    
    /** æ¸²æŸ“é¢˜å‹ç½‘æ ¼ */
    function renderTypeGrid(distribution) {
      var gridDom = document.getElementById('typeGrid');
      if (!gridDom) return;
      
      var html = distribution.map(function(item) {
        var name = TYPE_NAMES[item.type] || item.type;
        return '<div class="type-item"><div class="type-name">' + name + '</div><div class="type-count">' + item.wrongCount + '</div><div class="type-rate">é”™è¯¯ç‡ ' + item.wrongRate + '%</div></div>';
      }).join('');
      
      gridDom.innerHTML = html;
    }
    
    /** æ¸²æŸ“é«˜é¢‘é”™é¢˜åˆ—è¡¨ */
    function renderHighFreqList(highFreqWrong) {
      var listDom = document.getElementById('highFreqList');
      if (!listDom) return;
      
      if (!highFreqWrong || highFreqWrong.length === 0) {
        listDom.innerHTML = '<div style="text-align: center; padding: 30px; color: #999; font-size: 14px;">æš‚æ— é«˜é¢‘é”™é¢˜æ•°æ®</div>';
        return;
      }
      
      var html = highFreqWrong.map(function(item, index) {
        var rankClass = index === 0 ? 'top1' : (index === 1 ? 'top2' : (index === 2 ? 'top3' : 'normal'));
        var subjectColor = SUBJECT_COLORS[item.subjectId] || '#999';
        var subjectName = SUBJECT_NAMES[item.subjectId] || item.subjectId;
        var typeName = TYPE_NAMES[item.type] || item.type;
        
        return '<div class="high-freq-item">' +
          '<div class="high-freq-rank ' + rankClass + '">' + (index + 1) + '</div>' +
          '<div class="high-freq-content">' +
            '<div class="high-freq-question">' + item.content + '</div>' +
            '<div class="high-freq-meta">' +
              '<span class="high-freq-tag" style="background: ' + subjectColor + '">' + subjectName + '</span>' +
              '<span class="high-freq-type">' + typeName + '</span>' +
              '<span class="high-freq-count">é”™ ' + item.wrongCount + ' æ¬¡</span>' +
            '</div>' +
          '</div>' +
        '</div>';
      }).join('');
      
      listDom.innerHTML = html;
    }
    
    /** æ›´æ–°å›¾è¡¨æ•°æ® - ç”± ArkTS è°ƒç”¨ */
    function updateCharts(dataJson) {
      try {
        var data = JSON.parse(dataJson);
        renderCharts(data);
      } catch (e) {
        console.error('updateCharts error:', e);
      }
    }
    
    /** çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜å›¾è¡¨ */
    window.addEventListener('resize', function() {
      if (subjectPieChart) subjectPieChart.resize();
      if (typePieChart) typePieChart.resize();
      if (trendLineChart) trendLineChart.resize();
      if (weekBarChart) weekBarChart.resize();
    });
  </script>
</body>
</html>
