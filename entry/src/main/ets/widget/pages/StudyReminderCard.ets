/**
 * å­¦ä¹ æé†’å¡ç‰‡ (2x2)
 * æé†’ç”¨æˆ·æ¯æ—¥åˆ·é¢˜æ‰“å¡
 */
let storageReminder = new LocalStorage();

@Entry(storageReminder)
@Component
struct StudyReminderCard {
  @LocalStorageProp('todayCount') todayCount: number = 0;
  @LocalStorageProp('targetCount') targetCount: number = 20;
  @LocalStorageProp('isCheckedIn') isCheckedIn: boolean = false;
  @LocalStorageProp('streakDays') streakDays: number = 0;
  @LocalStorageProp('encourageText') encourageText: string = 'ðŸ“š å¼€å§‹ä»Šå¤©çš„å­¦ä¹ å§ï¼';

  build() {
    Stack() {
      // èƒŒæ™¯å›¾
      Image($r('app.media.CardBackground'))
        .width('100%')
        .height('100%')
        .objectFit(ImageFit.Cover)
        .borderRadius(16)

      // æ¸å˜é®ç½©å±‚
      Column()
        .width('100%')
        .height('100%')
        .borderRadius(16)
        .linearGradient({
          direction: GradientDirection.RightBottom,
          colors: [['rgba(24, 144, 255, 0.85)', 0.0], ['rgba(9, 109, 217, 0.9)', 1.0]]
        })

      // å†…å®¹å±‚
      Column() {
        // é¡¶éƒ¨ï¼šåº”ç”¨åç§°
        Row() {
          Text('åˆ·é¢˜å®')
            .fontSize(12)
            .fontColor('#FFFFFF')
            .opacity(0.9)

          Blank()

          // æ‰“å¡çŠ¶æ€
          if (this.isCheckedIn) {
            Text('âœ“ å·²æ‰“å¡')
              .fontSize(10)
              .fontColor('#52C41A')
              .backgroundColor('rgba(82, 196, 26, 0.3)')
              .padding({ left: 6, right: 6, top: 2, bottom: 2 })
              .borderRadius(8)
          }
        }
        .width('100%')
        .padding({ left: 12, right: 12, top: 10 })

        // ä¸­é—´ï¼šä»Šæ—¥åšé¢˜æ•°
        Column() {
          Text(`${this.todayCount}`)
            .fontSize(40)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')

          Text(`/ ${this.targetCount} é¢˜`)
            .fontSize(12)
            .fontColor('#FFFFFF')
            .opacity(0.8)
            .margin({ top: 2 })
        }
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)

        // åº•éƒ¨ï¼šé¼“åŠ±æ–‡æ¡ˆ + è¿žç»­æ‰“å¡
        Column() {
          Text(this.encourageText)
            .fontSize(11)
            .fontColor('#FFFFFF')
            .opacity(0.95)
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })

          if (this.streakDays > 0) {
            Text(`ðŸ”¥ è¿žç»­æ‰“å¡ ${this.streakDays} å¤©`)
              .fontSize(10)
              .fontColor('#FFA940')
              .margin({ top: 4 })
          }
        }
        .width('100%')
        .padding({ left: 12, right: 12, bottom: 10 })
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .height('100%')
    }
    .width('100%')
    .height('100%')
    .borderRadius(16)
    .onClick(() => {
      postCardAction(this, {
        action: 'router',
        abilityName: 'EntryAbility',
        params: {
          targetPage: 'MainTabPage'
        }
      });
    })
  }
}
